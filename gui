import tkinter as tk
from tkinter import messagebox
import os

FILE_NAME = "gui_tasks.txt"

tasks = []

def load_tasks():
    if os.path.exists(FILE_NAME):
        with open(FILE_NAME, "r") as f:
            for line in f:
                tasks.append(line.strip())
                listbox.insert(tk.END, line.strip())

def save_tasks():
    with open(FILE_NAME, "w") as f:
        for task in tasks:
            f.write(task + "\n")

def add_task():
    task = task_entry.get()
    priority = priority_var.get()
    if task == "":
        messagebox.showwarning("Warning", "Task cannot be empty")
        return
    task_text = f"{task} | Priority: {priority} | Pending"
    tasks.append(task_text)
    listbox.insert(tk.END, task_text)
    save_tasks()
    task_entry.delete(0, tk.END)

def remove_task():
    try:
        index = listbox.curselection()[0]
        listbox.delete(index)
        tasks.pop(index)
        save_tasks()
    except:
        messagebox.showwarning("Warning", "Select a task to remove")

def mark_complete():
    try:
        index = listbox.curselection()[0]
        task = tasks[index].replace("Pending", "Completed")
        tasks[index] = task
        listbox.delete(index)
        listbox.insert(index, task)
        save_tasks()
    except:
        messagebox.showwarning("Warning", "Select a task")

def edit_task():
    try:
        index = listbox.curselection()[0]
        new_task = task_entry.get()
        priority = priority_var.get()
        if new_task == "":
            return
        tasks[index] = f"{new_task} | Priority: {priority} | Pending"
        listbox.delete(index)
        listbox.insert(index, tasks[index])
        save_tasks()
        task_entry.delete(0, tk.END)
    except:
        messagebox.showwarning("Warning", "Select a task to edit")

# Window
root = tk.Tk()
root.title("Advanced GUI Task Manager")
root.geometry("500x500")

# Title
tk.Label(root, text="Task Manager", font=("Arial", 18)).pack(pady=10)

# Entry
task_entry = tk.Entry(root, width=40)
task_entry.pack(pady=5)

# Priority
priority_var = tk.StringVar(value="Medium")
tk.OptionMenu(root, priority_var, "High", "Medium", "Low").pack()

# Buttons
tk.Button(root, text="Add Task", width=20, command=add_task).pack(pady=3)
tk.Button(root, text="Edit Task", width=20, command=edit_task).pack(pady=3)
tk.Button(root, text="Remove Task", width=20, command=remove_task).pack(pady=3)
tk.Button(root, text="Mark Completed", width=20, command=mark_complete).pack(pady=3)

# Listbox
listbox = tk.Listbox(root, width=60, height=12)
listbox.pack(pady=10)

load_tasks()
root.mainloop()
